<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dataset y Tabulados ‚Äî Omomobility</title>
  <meta name="description" content="Exportaci√≥n de datos, tabulados cruzados y an√°lisis estad√≠stico de las encuestas de percepci√≥n." />
  <link rel="icon" href="logcho.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="dataset.css" />
</head>
<body>
  <div class="page">
    <header class="header">
      <img class="logo" src="logcho.png" alt="Omomobility" onerror="this.onerror=null; this.src='logch.png'" />
      <div>
        <h1>Dataset y Tabulados</h1>
        <p class="lead">Exportaci√≥n de datos, an√°lisis cruzado y reportes estad√≠sticos de las encuestas</p>
      </div>
    </header>

    <div class="actions no-print" style="margin: 12px 0;">
      <a href="index.html" class="btn outline">‚Üê Inicio</a>
    </div>

    <!-- Panel de estad√≠sticas generales -->
    <div class="stats-panel">
      <h2 class="section-title">üìä Resumen del Dataset</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìù</div>
          <div class="stat-value" id="total-surveys">0</div>
          <div class="stat-label">Encuestas totales</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-value" id="date-range">‚Äî</div>
          <div class="stat-label">Rango de fechas</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-value" id="unique-zones">0</div>
          <div class="stat-label">Zonas cubiertas</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">‚≠ê</div>
          <div class="stat-value" id="avg-intention">0.0</div>
          <div class="stat-label">Intenci√≥n promedio</div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de exportaci√≥n -->
    <div class="export-section">
      <h2 class="section-title">üì§ Exportar Datos</h2>
      <div class="export-grid">
        <div class="export-card">
          <div class="export-icon">üìä</div>
          <h3>CSV Completo</h3>
          <p>Todas las encuestas con todos los campos en formato CSV para Excel/Sheets</p>
          <button class="btn" id="btn-export-csv-full">Descargar CSV</button>
        </div>

        <div class="export-card">
          <div class="export-icon">üìà</div>
          <h3>CSV Resumido</h3>
          <p>Solo campos clave: edad, zona, ocupaci√≥n, intenci√≥n, barreras</p>
          <button class="btn outline" id="btn-export-csv-summary">Descargar Resumido</button>
        </div>

        <div class="export-card">
          <div class="export-icon">üìã</div>
          <h3>JSON</h3>
          <p>Formato JSON para an√°lisis program√°tico o integraci√≥n con APIs</p>
          <button class="btn outline" id="btn-export-json">Descargar JSON</button>
        </div>

        <div class="export-card">
            <div class="export-icon">üìÑ</div>
            <h3>Reporte PDF</h3>
            <p>Documento ejecutivo con tabulados y gr√°ficas principales</p>
            <button class="btn" id="btn-preview-pdf">Vista Previa PDF</button>
            <button class="btn outline" id="btn-export-pdf" style="margin-top: 8px;">Descargar PDF</button>
          </div>
      </div>
    </div>

    <!-- Secci√≥n de tabulados cruzados -->
    <div class="tabulation-section">
      <h2 class="section-title">üìä Tabulados Cruzados</h2>
      <p class="section-description">
        An√°lisis de relaciones entre variables clave. Selecciona dos variables para ver su distribuci√≥n cruzada.
      </p>

      <div class="tabulation-controls">
        <div class="control-group">
          <label for="var-rows">Variable en filas:</label>
          <select id="var-rows" class="select-control">
            <option value="edad_grupo">Grupo de edad</option>
            <option value="zona">Zona</option>
            <option value="ocupacion">Ocupaci√≥n</option>
            <option value="sexo">Sexo</option>
            <option value="ingreso">Ingreso mensual</option>
            <option value="uso">Uso principal</option>
            <option value="usaMoto">Usa moto actualmente</option>
            <option value="intencion_grupo">Intenci√≥n de compra (agrupada)</option>
          </select>
        </div>

        <div class="control-group">
          <label for="var-cols">Variable en columnas:</label>
          <select id="var-cols" class="select-control">
            <option value="intencion_grupo" selected>Intenci√≥n de compra (agrupada)</option>
            <option value="edad_grupo">Grupo de edad</option>
            <option value="zona">Zona</option>
            <option value="ocupacion">Ocupaci√≥n</option>
            <option value="sexo">Sexo</option>
            <option value="ingreso">Ingreso mensual</option>
            <option value="uso">Uso principal</option>
            <option value="usaMoto">Usa moto actualmente</option>
          </select>
        </div>

        <div class="control-group">
          <label for="display-mode">Mostrar:</label>
          <select id="display-mode" class="select-control">
            <option value="count">Frecuencias (n)</option>
            <option value="percent-row">Porcentaje por fila (%)</option>
            <option value="percent-col">Porcentaje por columna (%)</option>
            <option value="percent-total">Porcentaje del total (%)</option>
          </select>
        </div>

        <button class="btn" id="btn-generate-table">Generar Tabla</button>
        <button class="btn outline" id="btn-export-table">Exportar Tabla</button>
      </div>

      <div id="tabulation-result" class="tabulation-result">
        <p class="placeholder-text">Selecciona las variables y haz clic en "Generar Tabla" para ver el tabulado cruzado.</p>
      </div>
    </div>

    <!-- Secci√≥n de an√°lisis estad√≠stico -->
    <div class="statistics-section">
      <h2 class="section-title">üìà An√°lisis Estad√≠stico</h2>
      
      <div class="stats-tabs">
        <button class="tab-btn active" data-tab="descriptive">Estad√≠stica Descriptiva</button>
        <button class="tab-btn" data-tab="barriers">An√°lisis de Barreras</button>
        <button class="tab-btn" data-tab="brands">Marcas Mencionadas</button>
        <button class="tab-btn" data-tab="correlations">Correlaciones</button>
      </div>

      <div class="stats-content">
        <!-- Tab: Estad√≠stica Descriptiva -->
        <div class="tab-panel active" id="tab-descriptive">
          <h3>Variables Num√©ricas</h3>
          <div class="table-responsive">
            <table class="stats-table" id="descriptive-table">
              <thead>
                <tr>
                  <th>Variable</th>
                  <th>n</th>
                  <th>Media</th>
                  <th>Mediana</th>
                  <th>Desv. Est.</th>
                  <th>M√≠n</th>
                  <th>M√°x</th>
                </tr>
              </thead>
              <tbody>
                <!-- Generado din√°micamente -->
              </tbody>
            </table>
          </div>

          <h3 style="margin-top: 24px;">Variables Categ√≥ricas</h3>
          <div class="table-responsive">
            <table class="stats-table" id="categorical-table">
              <thead>
                <tr>
                  <th>Variable</th>
                  <th>Categor√≠a</th>
                  <th>Frecuencia</th>
                  <th>Porcentaje</th>
                </tr>
              </thead>
              <tbody>
                <!-- Generado din√°micamente -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: An√°lisis de Barreras -->
        <div class="tab-panel" id="tab-barriers">
          <h3>Barreras Principales (Frecuencia de Menci√≥n)</h3>
          <div class="table-responsive">
            <table class="stats-table" id="barriers-table">
              <thead>
                <tr>
                  <th>Barrera</th>
                  <th>Menciones</th>
                  <th>% del Total</th>
                  <th>Visualizaci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <!-- Generado din√°micamente -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Marcas Mencionadas -->
        <div class="tab-panel" id="tab-brands">
          <h3>Marcas Mencionadas (Top of Mind)</h3>
          <div class="table-responsive">
            <table class="stats-table" id="brands-table">
              <thead>
                <tr>
                  <th>Marca</th>
                  <th>Menciones Espont√°neas</th>
                  <th>Menciones Asistidas</th>
                  <th>Total</th>
                  <th>% Awareness</th>
                </tr>
              </thead>
              <tbody>
                <!-- Generado din√°micamente -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: Correlaciones -->
        <div class="tab-panel" id="tab-correlations">
          <h3>Matriz de Correlaciones (Variables Num√©ricas)</h3>
          <p class="note">Coeficiente de correlaci√≥n de Pearson entre variables num√©ricas clave</p>
          <div class="table-responsive">
            <table class="stats-table correlation-matrix" id="correlation-table">
              <thead>
                <tr>
                  <th>Variable</th>
                  <th>Edad</th>
                  <th>Intenci√≥n</th>
                  <th>Disp. Pagar</th>
                  <th>Favorabilidad</th>
                </tr>
              </thead>
              <tbody>
                <!-- Generado din√°micamente -->
              </tbody>
            </table>
          </div>
          <div class="correlation-legend">
            <span class="legend-item"><span class="color-box strong-positive"></span> Fuerte positiva (>0.7)</span>
            <span class="legend-item"><span class="color-box moderate-positive"></span> Moderada positiva (0.3-0.7)</span>
            <span class="legend-item"><span class="color-box weak"></span> D√©bil (-0.3 a 0.3)</span>
            <span class="legend-item"><span class="color-box moderate-negative"></span> Moderada negativa (-0.7 a -0.3)</span>
            <span class="legend-item"><span class="color-box strong-negative"></span> Fuerte negativa (<-0.7)</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de filtros avanzados -->
    <div class="filters-section">
      <h2 class="section-title">üîç Filtros Avanzados</h2>
      <p class="section-description">Filtra el dataset antes de exportar o generar tabulados</p>
      
      <div class="filters-grid">
        <div class="filter-group">
          <label>Rango de edad:</label>
          <div class="range-inputs">
            <input type="number" id="filter-edad-min" placeholder="M√≠n" min="15" max="80" />
            <span>‚Äî</span>
            <input type="number" id="filter-edad-max" placeholder="M√°x" min="15" max="80" />
          </div>
        </div>

        <div class="filter-group">
          <label>Zona:</label>
          <select id="filter-zona" class="select-control" multiple size="3">
            <option value="">Todas las zonas</option>
            <!-- Generado din√°micamente -->
          </select>
        </div>

        <div class="filter-group">
          <label>Ocupaci√≥n:</label>
          <select id="filter-ocupacion" class="select-control">
            <option value="">Todas</option>
            <option value="Estudiante">Estudiante</option>
            <option value="Empleado">Empleado</option>
            <option value="Independiente">Independiente</option>
            <option value="Repartidor">Repartidor</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Intenci√≥n m√≠nima:</label>
          <input type="number" id="filter-intencion-min" class="select-control" min="0" max="10" placeholder="0-10" />
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn" id="btn-apply-filters">Aplicar Filtros</button>
        <button class="btn outline" id="btn-clear-filters">Limpiar Filtros</button>
        <span id="filter-status" class="filter-status"></span>
      </div>
    </div>

    <!-- Footer con informaci√≥n -->
    <div class="info-section">
      <h2 class="section-title">‚ÑπÔ∏è Informaci√≥n del Dataset</h2>
      <div class="info-grid">
        <div class="info-card">
          <h4>Campos Disponibles</h4>
          <ul class="field-list" id="fields-list">
            <!-- Generado din√°micamente -->
          </ul>
        </div>

        <div class="info-card">
          <h4>Notas Metodol√≥gicas</h4>
          <ul>
            <li><strong>Agrupaci√≥n de edad:</strong> 15-24, 25-34, 35-44, 45-54, 55+</li>
            <li><strong>Intenci√≥n agrupada:</strong> Baja (0-3), Media (4-6), Alta (7-10)</li>
            <li><strong>Datos faltantes:</strong> Se muestran como "N/A" en las tablas</li>
            <li><strong>Barreras:</strong> Campo de selecci√≥n m√∫ltiple, cada barrera se cuenta independientemente</li>
          </ul>
        </div>

        <div class="info-card">
          <h4>Formatos de Exportaci√≥n</h4>
          <ul>
            <li><strong>CSV:</strong> Compatible con Excel, Google Sheets, SPSS</li>
            <li><strong>JSON:</strong> Para an√°lisis program√°tico (Python, R, JavaScript)</li>
            <li><strong>PDF:</strong> Reporte ejecutivo con gr√°ficas y tabulados principales</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="foot">
      <a href="index.html" class="btn outline">‚Üê Volver al inicio</a>
      <a href="listadeencuestas.html" class="btn">Ver lista de encuestas</a>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth.js"></script>
  
  <!-- Librer√≠as para exportaci√≥n -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Script principal -->
  <script src="dataset.js"></script>
</body>
</html>