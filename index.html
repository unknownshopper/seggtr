<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Omomobility • Estudio de Mercado — Inicio</title>
  <meta name="description" content="Portal del proyecto: estudio de mercado para Omomobility en Villahermosa. Accesos a propuesta, presentación, anexo, encuesta, modelo TCO y dataset." />
  <link rel="icon" href="logcho.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
  <div class="shell">
    <header class="hero">
      <img class="logo" src="logcho.png" alt="The Unknown Shopper — logotipo" onerror="this.onerror=null; this.src='logch.png'" />
      <div class="titles">
        <h1>Portal del proyecto — Omomobility</h1>
        <p>Estudio de mercado en Villahermosa: accesos a documentos, módulos y herramientas.</p>
      </div>
      <div class="meta">
        <div><strong>Fecha:</strong> <span id="today">--/--/----</span></div>
      </div>
    </header>

    <main>
      <h2 class="section-title">Accesos rápidos</h2>

      <div id="status" class="status-bar" aria-live="polite">
        <div><strong>Fecha de corte:</strong> <span id="cutoff">Cargando…</span></div>
        <div><strong>Encuestas:</strong> <span id="count">–</span></div>
        <div><strong>Versión:</strong> <span id="version">1.0.0</span></div>
      </div>

      <div class="grid">
        <a class="cardlink" href="carta_propuesta_omomobility.html" target="_blank" rel="noopener">
          <div class="card">
            <span class="tag">Documento</span>
            <h3>Propuesta de servicios</h3>
            <p>Alcance, metodología, entregables, cronograma e inversión.</p>
          </div>
        </a>

        <a class="cardlink" href="encuesta_metodologia.html" target="_blank" rel="noopener">
          <div class="card">
            <span class="tag">Campo</span>
            <h3>Metodología de encuesta</h3>
            <p>Itinerario operativo, cuotas y lineamientos para el levantamiento.</p>
          </div>
        </a>
        <a class="cardlink" href="competencia.html">
          <div class="card">
            <span class="tag">Análisis</span>
            <h3>Competencia y oferta</h3>
            <p>Comparativo de competencia, testimonios y recomendaciones estratégicas.</p>
          </div>
        </a>
             
      
        <a class="cardlink" href="encuesta.html">
          <div class="card">
            <span class="tag">Encuesta</span>
            <h3>Cuestionario y captura</h3>
            <p>Formulario digital con almacenamiento (local) — acceso restringido.</p>
          </div>
        </a>

        <a class="cardlink" href="listadeencuestas.html">
          <div class="card">
            <span class="tag">Datos</span>
            <h3>Lista de encuestas</h3>
            <p>Consulta y gestiona hasta 250 encuestas almacenadas.</p>
          </div>
        </a>

       
      
        <a class="cardlink" href="resultados.html">
          <div class="card">
            <span class="tag">Dashboard</span>
            <h3>Resultados y gráficas</h3>
            <p>KPIs y visualizaciones interactivas de las encuestas.</p>
          </div>
        </a>
      
        
      
        <a class="cardlink" href="tco.html">
          <div class="card">
            <span class="tag">Finanzas</span>
            <h3>Modelo TCO</h3>
            <p>Comparativo eléctrica vs. combustión.</p>
          </div>
        </a>
      
        <a class="cardlink" href="dataset.html">
          <div class="card">
            <span class="tag">Datos</span>
            <h3>Dataset y tabulados</h3>
            <p>Exportaciones CSV/JSON/PDF, tabulados cruzados y análisis estadístico completo.</p>
          </div>
        </a>

        <a class="cardlink" href="presentacion.html" target="_blank" rel="noopener">
          <div class="card">
            <span class="tag">Slides</span>
            <h3>Presentación ejecutiva</h3>
            <p>Roadmap, KPIs y principales Hallazgos (placeholder).</p>
          </div>
        </a>

        <a class="cardlink" href="inversion.html">
          <div class="card">
            <span class="tag">Inversión</span>
            <h3>Ranking de zonas</h3>
            <p>Puntuación compuesta: intención, awareness, favorabilidad y muestra.</p>
          </div>
        </a>

        <a class="cardlink" href="observaciones.html">
          <div class="card">
            <span class="tag">Análisis</span>
            <h3>Observaciones (Villahermosa)</h3>
            <p>Evidencias, oportunidades, riesgos y plan por fases.</p>
          </div>
        </a>

        <a class="cardlink" href="justjuri.html">
          <div class="card">
            <span class="tag">Legal</span>
            <h3>Justificación jurídica</h3>
            <p>Base legal, confidencialidad, PI y conformidades del sistema.</p>
          </div>
        </a>

      </div>
    </main>

    <footer class="footer">
      <div>Proyecto • The Unknown Shopper</div>
      <div id="generated">--/--/----</div>
    </footer>
  </div>
 
  <!-- SDK Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>


<!-- Tus scripts -->
<script src="auth.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (window.AuthSystem && typeof AuthSystem.checkAuthOnProtectedPages === 'function') {
      AuthSystem.checkAuthOnProtectedPages();
    }
  });
</script>
<script src="script.js"></script>

  <script>
  (async function(){
    const fmt = new Intl.DateTimeFormat('es-MX',{dateStyle:'long', timeStyle:'short'});
    const cutoffEl = document.getElementById('cutoff');
    const countEl = document.getElementById('count');
    const versionEl = document.getElementById('version');

    async function loadVersion(){
      try{
        const res = await fetch('version.json', {cache:'no-store'});
        if(res.ok){
          const v = await res.json();
          versionEl.textContent = v.version || '1.0.0';
          return;
        }
      }catch(_){}
      versionEl.textContent = '1.0.0';
    }

    async function loadFromFirestore(){
      try{
        if(!window.db) return false;
        const col = window.db.collection('surveys');
        const all = await col.get();
        const total = all.size;
        const capped = Math.min(total, 250);
        countEl.textContent = String(capped);
        const latest = await col.orderBy('_createdAt','desc').limit(1).get();
        const ts = latest.empty ? null : latest.docs[0].get('_createdAt');
        cutoffEl.textContent = ts ? fmt.format(new Date(ts)) : '—';
        return true;
      }catch(e){
        return false;
      }
    }

    function loadFromLocal(){
      try{
        const arr = JSON.parse(localStorage.getItem('encuestas')||'[]');
        const n = Array.isArray(arr)? arr.length : 0;
        const capped = Math.min(n, 250);
        countEl.textContent = String(capped);
        if(n>0){
          const last = arr.reduce((a,b)=> (new Date(a.ts||0) > new Date(b.ts||0) ? a : b), arr[0]);
          cutoffEl.textContent = last?.ts ? fmt.format(new Date(last.ts)) : '—';
        }else{
          cutoffEl.textContent = '—';
        }
      }catch(_){
        cutoffEl.textContent = '—';
        countEl.textContent = '—';
      }
    }

    await loadVersion();
    const ok = await loadFromFirestore();
    if(!ok) loadFromLocal();
  })();
  </script>
 
</body>
</html>
